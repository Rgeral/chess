# ---- Builder ----
FROM rust:1.80-slim as builder

WORKDIR /app

RUN rustup install nightly && rustup default nightly

# Copier seulement Cargo.toml (pas Cargo.lock)
COPY Cargo.toml ./
RUN mkdir src && echo "fn main() {}" > src/main.rs
RUN cargo +nightly build --release || true

# Copier le reste
COPY . .

RUN cargo +nightly build --release
